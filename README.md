# Card Management System

Card Management is a Spring Boot application that used Firestore-backed database along with Google KMS for security.

## Getting Started

### Run the Application
```bash
./gradlew bootRun
```
On startup the Gradle task opens `http://localhost:8080` automatically.

### Run Tests
```bash
./gradlew test
```
Simple WebMvc slice test, asserts the card creation and search endpoint returns the expected responses.

## Brief Database Description & Reasoning (for deliverables)

- **Chosen DB:** Google Firestore (NoSQL).
- **Reasoning:** Firestore would best matche team needs for further collaboration if needed in the future, It was a better choice as it would need less stepup for handling keys as i knew i was gonna use Google KMS, and minimal local setup. 
Compared to MySQL, it eliminates local Docker/seed complexity and centralizes data for all and compared to H2, it provides shared persistence and production-like security controls.


## Architecture Overview/Process
- **Prototype**: [Figma design](https://www.figma.com/design/IUmM4cdMf6xA9HQIMw1ZAv/Card_management?node-id=0-1&t=1cB3sJ1r70qxiB0M-1) guided the UI layout for the project.
- **Frontend**: Static HTML/JavaScript stored in `src/main/resources/static`.
- **Backend**: Spring Boot (Java 17).
- **Database**: Google Firestore.

## Database Structure & Security Strategy
Firestore stores card records in the `cards` collection. Each document follows the structure below:

| Field            | Type     | Description                                                                                  |
|------------------|----------|----------------------------------------------------------------------------------------------|
| `id`             | string   | Firestore document identifier (UUID generated by Firestore itself).                          |
| `cardholderName` | string   | Cardholder name.                                                                             |
| `panCiphertext`  | string   | Base64-encoded ciphertext of the full PAN encrypted with Google Cloud KMS.                   |
| `lastFourHash`   | string   | SHA-256 hash of the final four digits, used for equality searches without decrypting the PAN.|
| `createdAt`      | instant  | Timestamp captured when the card is persisted.                                               |

**Why two fields (`panCiphertext`, `lastFourHash`)?**
- Encrypting the full PAN prevents accidental leaks if the database is compromised.
- Hashing the last four digits allows equality searches (`/api/cards?last4=1234`) without exposing PAN data or requiring decryption keys on the API server.
- Google Cloud KMS manages encryption keys so the application never stores long-lived secrets.

## API Endpoints

| Method | Endpoint            |
|--------|---------------------|
| POST   | `/api/cards`        | 
| GET    | `/api/cards`        | 
| GET    | `/api/cards/search` | 


