<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add Card | SafeCard</title>
    <link rel="stylesheet" href="assets/styles.css" />
  </head>
  <body>
    <div class="page">
      <a href="index.html" class="back-link">‚Üê Back to Dashboard</a>
      <h1 class="page-title">Add New Card</h1>
      <p class="page-subtitle">
        Securely add a new cardholder record to the system
      </p>

      <section class="card">
        <div class="card-header">
          <div class="card-header-icon"></div>
          <div>
            <h2>Cardholder Information</h2>
            <p>Enter the card details below. All data will be encrypted.</p>
          </div>
        </div>

        <form id="addCardForm" class="form-grid">
          <div>
            <label for="cardholderName">
              Cardholder Name *
              <span>Full name as it appears on the card.</span>
            </label>
            <input
              type="text"
              id="cardholderName"
              name="cardholderName"
              placeholder="e.g., John Doe"
              required
            />
          </div>

          <div>
            <label for="cardNumber">
              Card Number (PAN) *
              <span>16 digits - will be encrypted before storage.</span>
            </label>
            <input
              type="text"
              id="cardNumber"
              name="cardNumber"
              inputmode="numeric"
              maxlength="19"
              placeholder="1234 5678 9012 3456"
              required
            />
          </div>

          <button type="submit" class="action-button primary">
            Add Card Securely
          </button>
          <div id="formMessage" class="message"></div>
        </form>
      </section>
    </div>

    <script src="assets/app.js"></script>
    <script>
      const form = document.getElementById("addCardForm");
      const messageEl = document.getElementById("formMessage");

      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        CardUi.clearMessage(messageEl);

        const formData = new FormData(form);
        const payload = {
          cardholderName: formData.get("cardholderName")?.trim(),
          pan: formData.get("cardNumber")?.replace(/\s+/g, ""),
        };

        if (!payload.pan || payload.pan.replace(/\D/g, "").length !== 16) {
          CardUi.showMessage(
            messageEl,
            "Please enter a valid 16-digit card number.",
            "error"
          );
          return;
        }

        try {
          await CardApi.addCard(payload);
          CardUi.showMessage(
            messageEl,
            "Card added successfully and is now stored securely.",
            "success"
          );
          form.reset();
        } catch (error) {
          CardUi.showMessage(messageEl, error.message, "error");
        }
      });
    </script>
  </body>
</html>
